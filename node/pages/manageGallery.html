<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>sts | Admin - manage gallery</title>
    <link rel="icon" href="/images/favicon.ico" type="image/x-icon">
    <link href="/styles/reset.css" rel="stylesheet">
    <link href="/styles/main.css" rel="stylesheet">
    <link href="/styles/stsadmin.css" rel="stylesheet">
    <link href="/styles/burger.css" rel="stylesheet">
    <link href="/styles/form.css" rel="stylesheet">
    <link href="/styles/responsive.css" rel="stylesheet">
  </head>
  <body>
    <div class="wrapper"> <!--wrapper div-->
      <div> <!-- wraps header -->
        <header class="">
          <div class="topbar">
            <div class="topbar-left canFade">
              <a class="topbar-left-link" id="homepage-topbar-left" href="/">
                <img class="topbar-left-logo" src="/images/topbar-stslogo-dark.png">
              </a>
            </div>
            <h1 class="stsadmin-headertitle">Admin</h1>
            <div id="navOverlay"></div>
            {{#adminburger}}{{/adminburger}}
          </div>
        </header>
        <div class="fixedheader-spacer" id="top"></div>
      </div> <!-- end header -->

      <main class="">
        <div class="admin-page">
          <div class="admin-container">
            <div class="admin-panel">
              <h2 class="stsadmin-subheader">Manage Gallery</h2>
              <div class="admin-form-container">
                <div class="admin-form">
                  <h3>Add Gallery Photo</h3>
                  <label class="form-label">Image url</label>
                  <div class="inline-input">
                    <form class="inline-form stsphotosubmit" enctype="text/plain">
                      <input class="inline-inputInput" type="text" name="photosubmit-input" id="photosubmit-input" placeholder="Enter image url here" required>
                      <input class="submit submit-btn grn" type="submit" value="Add">
                    </form>
                  </div>
                </div>
                <div class="admin-form">
                  <h3>Update Gallery Photo</h3>
                  <form class="" enctype="text/plain">
                    <label class="form-label">Image ID</label>
                    <input class="" type="text" name="photoupdate-id" id="photoupdate-id" placeholder="Enter image ID here" required>
                    <label class="form-label">Image url</label>
                    <div class="inline-input">
                      <input class="inline-inputInput" type="text" name="photoupdate-url" id="photoupdate-url" placeholder="Enter new image url here" required>
                      <input onclick="updatePhoto(); return false;" class="submit submit-btn grn" type="submit" value="Update">
                    </div>
                  </form>
                </div>
                <div class="admin-form">
                  <h3>Delete Photo By ID</h3>
                  <label class="form-label">Image ID</label>
                  <div class="inline-input">
                    <form class="inline-form" enctype="text/plain">
                      <input class="inline-inputInput" type="text" name="photo-id" id="photo-id" placeholder="Enter image ID here" required>
                      <input onclick="deleteGalleryById(); return false;" class="submit submit-btn grn" type="submit" value="Delete">
                    </form>
                  </div>
                </div>
                <input onclick="deleteGallery(); return false;" class="submit-btn eraseAll" type="button" value="Erase Gallery"></input>
                <a class="back-to" href="/admin"><p><-- back to main</p></a>
              </div>
            </div>
          </div>
        </div>
      </main>
      <footer class="admin-footer">
        <p class="footer-copyright">&copy; 2018 Jared Gorski</p>
      </footer>
    </div> <!--closes wrapper div-->

<script src="https://cdn.wedeploy.com/api/4.2.0/wedeploy.js">if (auth.currentUser == null) {location.href = '/adminLogin';}</script>
<script>
  var auth = WeDeploy.auth('auth-stesse.wedeploy.io');

  function out() {
   auth.signOut()
   .then(() => {
     location.href = '/adminLogin';
   });
  }

  if (auth.currentUser == null) {location.href = '/adminLogin';}
</script>
<script>
  var form = document.querySelector('.stsphotosubmit');
  form.addEventListener('submit', function(e) {
    e.preventDefault();
    let photoData = {
      message: document.getElementById('photosubmit-input').value,
    }
    let photoSubmission = "Photo Link(s): " + photoData.message;
    var imageUrl = photoData.message; var goodImage = imageUrl.includes(".jpg") || imageUrl.includes(".jpeg");
    if (goodImage) {
      WeDeploy
        .data('data-stesse.wedeploy.io')
        .create('stsdataPhotos', photoData)
        .then(function(response) {
          form.reset();
          console.info('Saved:', response);
          WeDeploy 
            .email('email-stesse.wedeploy.io')
            .auth('74550c77-dc21-4e9d-9908-75f2d960eb73')
            .from('jared.gorski@wedeploy.com')
            .to('jared.gorski@liferay.com')
            .subject("Stesse - New Photo Submission")
            .message(photoSubmission)
            .send()
            .then(function(response) {
              console.log(response);
              alert('Thank you for your submission!');
            })
            .catch(function(error) {
              console.log(error);
              alert('There was an error. Please try again!');
            });
          })
        .catch(function(error)
          {
            console.log(error);
          });
      } else {
        alert('Only direct urls to .jpg images will be accepted. Please check your url and try again.')
      }
    });
</script>
<script>
  function updatePhoto() {
    var photoUpdateId = document.getElementById('photoupdate-id').value;
    var photoUpdateUrl = document.getElementById('photoupdate-url').value;
      WeDeploy
        .data('https://data-stesse.wedeploy.io')
        .update('stsdataPhotos/' + photoUpdateId, {
          "message": photoUpdateUrl
        }).then(function(success) {
          alert("Gallery updated!");
        });
  }

  function deleteGallery() {
    if (confirm("This will erase the entire gallery collection from the database. This cannot be undone. Continue?")) {
      WeDeploy
        .data('https://data-stesse.wedeploy.io')
        .delete('stsdataPhotos')
    }
  }

  function deleteGalleryById() {
    var photoId = document.getElementById('photo-id').value;
    if (photoId == '') {
      alert("Please enter a photo ID.");
    } else if (confirm("This will delete the specified photo from the database. This cannot be undone. Continue?")) {
      WeDeploy
        .data('https://data-stesse.wedeploy.io')
        .delete('stsdataPhotos/' + photoId)
    }
  }
</script>
  </body>
</html>